# 移除 uom 库计划

根据对嵌入式硬件驱动 crate 的常见实践、对本项目的分析以及 BQ76920 数据手册的查阅，决定移除 `uom`（Units Of Measurement）库，并使用适合嵌入式环境的原始数值类型。

## 移除步骤

1. **移除 `uom` 依赖：** 从 `Cargo.toml` 中移除 `uom` 依赖项。
2. **删除 `src/units.rs` 文件：** 删除专门用于定义 `uom` 单位的 `src/units.rs` 文件。
3. **修改 `src/data_types.rs`：** 将其中使用 `uom` 单位类型的地方替换为原始数值类型，并在注释中明确单位和缩放因子。
    * **电芯电压：** 使用 `u16` 或 `u32` 存储原始 14 位 ADC 值，或转换为以微伏 (μV) 为单位的 `u32`。
    * **电流：** 使用 `i16` 或 `i32` 存储原始 16 位库仑计数器值，或转换为以微伏 (μV) 为单位的跨感应电阻电压 (`i32`)。电流计算结果存储为以毫安 (mA) 或微安 (μA) 为单位的整数。
    * **温度：** 转换为以厘摄氏度 (0.01 °C) 或毫摄氏度 (0.001 °C) 为单位的整数。
    * **总电压：** 存储为以毫伏 (mV) 为单位的 `u16` 或 `u32`。
    * **原始寄存器值：** 根据需要使用 `i16` 或 `u16`。
4. **修改 `src/lib.rs`：**
    * 移除 `extern crate uom;` 声明。
    * 将所有使用 `uom` 单位类型的地方替换为上述确定的原始数值类型。
    * 修改相关的计算和转换逻辑，直接使用原始数值和查阅数据手册得到的比例因子进行计算，并确保单位的正确性。在必要的地方添加注释说明单位和缩放因子。
5. **更新测试文件并确保通过：** 修改使用 `uom` 的测试用例，根据新的数据类型调整断言。**重要提示：测试用例的逻辑不应修改，仅调整数据类型和断言以适应代码变化，并确保所有测试通过。**
6. **更新文档和示例：** 检查 `README.md` 和 `examples/` 目录，移除或修改与 `uom` 相关的内容，并更新数据类型的说明。

## 影响范围

* `Cargo.toml`
* `src/units.rs`
* `src/data_types.rs`
* `src/lib.rs`
* 测试文件 (可能包括 `tests/binrw_support.rs`)
* 文档 (`README.md`)
* 示例 (`examples/`)
